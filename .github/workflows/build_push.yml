name: Build 

on:
  workflow_dispatch:
    inputs:
      name:
        description: 'param1'
        required: false
        default: '*'
  push:
    branches:
      - 'develop'
  pull_request:
    branches:
      - main
      - develop


jobs:
  build-image:
    name: build image
    runs-on: self-hosted
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Checkout infra
        uses: actions/checkout@v2
        with:
          repository: BowellSolutions/bowell-infra
          token: ${{ secrets.GH_PAT }} 
          path: k8s_front
      - name: Get current date
        id: date
        run: echo "::set-output name=date::$(date +'%Y-%m-%d')"
      # - name: build the image
      #   run: |
      #     docker buildx build \
      #       --tag ${{ secrets.PCR_URL }}/bowelsound/frontend:${{ steps.date.outputs.date }}_${{ github.run_number }} \
      #       --platform linux/amd64 . \
      #       --cache-to type=registry,mode=max,ref=${{ secrets.PCR_URL }}/bowelsound/frontend_c:buildcache,push=true \
      #       --cache-from type=registry,ref=${{ secrets.PCR_URL }}/bowelsound/frontend_c:buildcache \
      #       --file=Dockerfile.prod --push=true 
            

